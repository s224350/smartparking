<html>
<head>
    <title>Home</title>
</head>
<body>

    <canvas id="canvas" width="417" height="600"></canvas>
    

<script>
const carImg = new Image();
const parkinglotImg = new Image();

const cars = [];
const parkingSpaces = [];

function addCar(spotID){
    spot = getParkingSpot(spotID);
    cars.push(new car(spot.x,spot.y,spot.rot,"parked",spotID)); 
}

function removeCar(spotID){
    removeCarByParkingSpot(spotID);
}

function car(x, y, rot, state, parkingSpotID) {
  this.x = x;
  this.y = y;
  this.rot = rot;
  this.state = state;
  this.parkingSpotID = parkingSpotID;
}

function parkingSpace(id, x, y, rot, occupied) {
  this.id = id;
  this.x = x;
  this.y = y;
  this.rot = rot;
  this.occupied = occupied;
}

function init() {
    carImg.src = "Car1.png";
    parkinglotImg.src = "parkinglot.png";

    


    parkingSpaces.push(new parkingSpace(1,260,105,180,false)); 
    parkingSpaces.push(new parkingSpace(2,358,105,180,false)); 
    parkingSpaces.push(new parkingSpace(3,260,492,0,false)); 
    parkingSpaces.push(new parkingSpace(4,358,492,0,false)); 

    window.requestAnimationFrame(draw);
}

function draw() {
    const ctx = document.getElementById("canvas").getContext("2d");



    /*for (var i=0;i<cars.length;i++){
        if (cars[i].state == "parking"){
            parkingSpot = getParkingSpot(cars[i].parkingSpotID);
            console.log(cars[i].x);
            if (cars[i].x < parkingSpot.x){
                cars[i].x++;
            } else if (cars[i].rot > 0){
                cars[i].rot -= 1;
            } else if (cars[i].y > parkingSpot.y){
                cars[i].y--;
            }
        }
    }*/



    drawBackground(ctx);
    drawCars(ctx);

    window.requestAnimationFrame(draw);
}

function getParkingSpot(id){
    for (var i=0;i<parkingSpaces.length;i++){
        if (parkingSpaces[i].id == id){
            return {x: parkingSpaces[i].x, y: parkingSpaces[i].y, rot: parkingSpaces[i].rot};
        }
    }
    return null;
}

function removeCarByParkingSpot(id){
    for (var i=0;i<cars.length;i++){
        if (cars[i].parkingSpotID == id){
            cars.splice(i,1);
        }
    }
}

function drawCars(ctx){
    for (var i=0;i<cars.length;i++){
        if (cars[i].state != "empty"){
            drawRotatedImage(ctx,carImg,cars[i].x,cars[i].y,cars[i].rot);
            console.log("Drawing car:"+cars[i].x+","+cars[i].y+","+cars[i].rot)
        }
    }
}

function drawBackground(ctx){
    ctx.drawImage(parkinglotImg,0,0);
    
}

function drawRotatedImage(ctx,img,x,y,angle){
    ctx.save();
    ctx.translate(x, y);
    ctx.rotate(angle*Math.PI/180);
    ctx.drawImage(img, -39,-70,78,140);
    ctx.restore();
}

init();

</script>

</body>
</html>